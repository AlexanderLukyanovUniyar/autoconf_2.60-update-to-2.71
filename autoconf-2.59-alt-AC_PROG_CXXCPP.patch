 autoconf/lib/autoconf/c.m4 |   18 ++++++++++++++----
 1 files changed, 14 insertions(+), 4 deletions(-)

diff --git a/autoconf/lib/autoconf/c.m4 b/autoconf/lib/autoconf/c.m4
index dead340..fbe1564 100644
--- a/autoconf/lib/autoconf/c.m4
+++ b/autoconf/lib/autoconf/c.m4
@@ -699,23 +699,33 @@ AC_ARG_VAR([CXXCPP],   [C++ preprocessor])dnl
 _AC_ARG_VAR_CPPFLAGS()dnl
 AC_LANG_PUSH(C++)dnl
 AC_MSG_CHECKING([how to run the C++ preprocessor])
+found_CXXCPP=
 if test -z "$CXXCPP"; then
   AC_CACHE_VAL(ac_cv_prog_CXXCPP,
   [dnl
     # Double quotes because CXXCPP needs to be expanded
     for CXXCPP in "$CXX -E" "/lib/cpp"
     do
-      _AC_PROG_PREPROC_WORKS_IFELSE([break])
+      _AC_PROG_PREPROC_WORKS_IFELSE([found_CXXCPP="$CXXCPP"; break])
     done
-    ac_cv_prog_CXXCPP=$CXXCPP
+    if test -n "$found_CXXCPP"; then
+      ac_cv_prog_CXXCPP="$found_CXXCPP"
+    else
+      ac_cv_prog_CXXCPP="$CXX -E"
+    fi
   ])dnl
   CXXCPP=$ac_cv_prog_CXXCPP
 else
+  found_CXXCPP=$CXXCPP
   ac_cv_prog_CXXCPP=$CXXCPP
 fi
-AC_MSG_RESULT([$CXXCPP])
-_AC_PROG_PREPROC_WORKS_IFELSE([],
+if test -n "$found_CXXCPP"; then
+  AC_MSG_RESULT([$CXXCPP])
+  _AC_PROG_PREPROC_WORKS_IFELSE([],
 	  [AC_MSG_FAILURE([C++ preprocessor "$CXXCPP" fails sanity check])])
+else
+  AC_MSG_RESULT([no])
+fi
 AC_SUBST(CXXCPP)dnl
 AC_LANG_POP(C++)dnl
 ])# AC_PROG_CXXCPP
